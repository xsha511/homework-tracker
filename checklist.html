<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯’å‡å­¦ä¹ è®¡åˆ’ Â· ä¸Šæµ·èµ«è´¤å­¦æ ¡</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600&family=Noto+Serif+SC:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-warm: #faf6f0;
            --bg-paper: #fffef9;
            --bg-accent: #f5f0e6;
            --text-primary: #2d2a26;
            --text-secondary: #6b6560;
            --text-muted: #9a9590;
            --border-light: #e8e4dc;
            --border-medium: #d4cfc5;
            --accent-coral: #e07a5f;
            --accent-sage: #81b29a;
            --accent-gold: #f2cc8f;
            --accent-navy: #3d405b;
            --accent-blue: #5c7cad;
            --accent-purple: #8e7cc3;
            --accent-teal: #4a9b8c;
            --accent-rose: #c97b84;
            --shadow-soft: 0 2px 8px rgba(45, 42, 38, 0.06);
            --shadow-medium: 0 4px 20px rgba(45, 42, 38, 0.08);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Serif SC', 'Crimson Pro', Georgia, serif;
            background: var(--bg-warm);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--bg-paper);
            border-bottom: 1px solid var(--border-light);
            padding: 24px 32px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .back-link:hover { color: var(--accent-coral); }

        .site-title {
            font-size: 20px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .view-switcher {
            display: flex;
            gap: 4px;
            background: var(--bg-accent);
            padding: 4px;
            border-radius: var(--radius-md);
        }

        .view-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--bg-paper);
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
        }

        /* Progress Section */
        .progress-section {
            background: var(--bg-paper);
            padding: 32px;
            margin: 24px auto;
            max-width: 1200px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            position: relative;
            z-index: 10;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: 180px 1fr auto;
            gap: 48px;
            align-items: center;
        }

        .progress-circle {
            position: relative;
            width: 140px;
            height: 140px;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle-bg {
            fill: none;
            stroke: var(--bg-accent);
            stroke-width: 12;
        }

        .progress-circle-fill {
            fill: none;
            stroke: var(--accent-sage);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.6s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percent {
            font-size: 36px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'Crimson Pro', serif;
        }

        .progress-label {
            font-size: 12px;
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .stats-row {
            display: flex;
            gap: 32px;
        }

        .stat-item {
            text-align: center;
            padding: 16px 24px;
            background: var(--bg-accent);
            border-radius: var(--radius-md);
            min-width: 100px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--accent-navy);
            font-family: 'Crimson Pro', serif;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Level Tooltip */
        .level-item {
            position: relative;
            cursor: help;
        }

        .level-tooltip {
            position: absolute;
            top: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 14px 18px;
            border-radius: var(--radius-md);
            font-size: 13px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            min-width: 200px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .level-tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-bottom-color: var(--text-primary);
        }

        .level-item:hover .level-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .level-tooltip-title {
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .level-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .level-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .level-num {
            font-weight: 600;
            color: var(--accent-gold);
            min-width: 32px;
        }

        .level-req {
            margin-left: auto;
            color: rgba(255,255,255,0.6);
            font-size: 11px;
        }

        .badges-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        .badges-title {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badges-grid {
            display: flex;
            gap: 8px;
        }

        .badge-item {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .badge-item:hover { transform: scale(1.15); }
        .badge-item.locked { background: var(--bg-accent); filter: grayscale(1); opacity: 0.4; }
        .badge-item.bronze { background: linear-gradient(135deg, #cd9b6a 0%, #b87333 100%); }
        .badge-item.silver { background: linear-gradient(135deg, #e8e8e8 0%, #b8b8b8 100%); }
        .badge-item.gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); box-shadow: 0 0 16px rgba(255, 215, 0, 0.4); }

        /* å‹‹ç«  Tooltip - å‘ä¸‹æ˜¾ç¤º */
        .badge-tooltip {
            position: absolute;
            top: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            text-align: center;
            min-width: 160px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .badge-tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-bottom-color: var(--text-primary);
        }

        .badge-item:hover .badge-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .badge-tooltip-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .badge-tooltip-level {
            color: var(--accent-gold);
            font-size: 12px;
            margin-bottom: 6px;
        }

        .badge-tooltip-desc {
            color: rgba(255,255,255,0.8);
            font-size: 12px;
            line-height: 1.4;
        }

        .badge-tooltip-progress {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 11px;
            color: var(--accent-sage);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px 48px;
            position: relative;
            z-index: 1;
        }

        /* Day View */
        .day-view { display: none; }
        .day-view.active { display: block; }
        .subject-view { display: none; }
        .subject-view.active { display: block; }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px 24px;
            background: var(--bg-paper);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-soft);
        }

        .week-nav {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: 1px solid var(--border-medium);
            background: var(--bg-paper);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: var(--accent-navy);
            color: white;
            border-color: var(--accent-navy);
        }

        .week-title {
            font-size: 18px;
            font-weight: 500;
        }

        .week-dates {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Day Cards - Vertical Layout */
        .days-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .day-card {
            background: var(--bg-paper);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            transition: box-shadow 0.2s;
        }

        .day-card:hover {
            box-shadow: var(--shadow-medium);
        }

        .day-card.today {
            border: 2px solid var(--accent-gold);
        }

        .day-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--bg-accent);
            border-bottom: 1px solid var(--border-light);
        }

        .day-info {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }

        .day-date {
            font-size: 24px;
            font-weight: 600;
            color: var(--accent-navy);
            font-family: 'Crimson Pro', serif;
        }

        .day-weekday {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .day-card.today .day-date {
            color: var(--accent-coral);
        }

        .day-summary {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .day-tasks-list {
            padding: 16px 24px;
        }

        .task-item {
            display: grid;
            grid-template-columns: 32px 1fr auto auto;
            gap: 16px;
            align-items: start;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background 0.2s;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item:hover {
            background: var(--bg-accent);
            margin: 0 -24px;
            padding-left: 24px;
            padding-right: 24px;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-medium);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-checkbox:hover {
            border-color: var(--accent-sage);
        }

        .task-checkbox.checked {
            background: var(--accent-sage);
            border-color: var(--accent-sage);
        }

        .task-checkbox.checked::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .task-content {
            min-width: 0;
        }

        .task-title {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .task-detail {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .task-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .task-time {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .task-tags {
            display: flex;
            gap: 6px;
        }

        .task-tag {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        .task-tag.required {
            background: #fce4e4;
            color: #c0392b;
        }

        .task-tag.optional {
            background: #e4f5ed;
            color: #27ae60;
        }

        .task-tag.subject {
            color: white;
        }

        .task-tag.english { background: var(--accent-coral); }
        .task-tag.chinese { background: var(--accent-rose); }
        .task-tag.math { background: var(--accent-blue); }
        .task-tag.physics { background: var(--accent-purple); }
        .task-tag.chemistry { background: var(--accent-teal); }
        .task-tag.biology { background: var(--accent-sage); }
        .task-tag.economics { background: var(--accent-gold); color: var(--text-primary); }
        .task-tag.geography { background: var(--accent-navy); }

        /* Subject View */
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 24px;
        }

        .subject-card {
            background: var(--bg-paper);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }

        .subject-header {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
        }

        .subject-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subject-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }

        .subject-icon.english { background: var(--accent-coral); }
        .subject-icon.chinese { background: var(--accent-rose); }
        .subject-icon.math { background: var(--accent-blue); }
        .subject-icon.physics { background: var(--accent-purple); }
        .subject-icon.chemistry { background: var(--accent-teal); }
        .subject-icon.biology { background: var(--accent-sage); }
        .subject-icon.economics { background: var(--accent-gold); }
        .subject-icon.geography { background: var(--accent-navy); }

        .subject-name {
            font-size: 17px;
            font-weight: 500;
        }

        .subject-progress {
            text-align: right;
        }

        .subject-progress-bar {
            width: 80px;
            height: 6px;
            background: var(--bg-accent);
            border-radius: 3px;
            overflow: hidden;
        }

        .subject-progress-fill {
            height: 100%;
            background: var(--accent-sage);
            border-radius: 3px;
            transition: width 0.4s ease;
        }

        .subject-progress-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .subject-tasks {
            padding: 16px 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .subject-task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
        }

        .subject-task-item:last-child {
            border-bottom: none;
        }

        .subject-task-item:hover {
            background: var(--bg-accent);
            margin: 0 -24px;
            padding-left: 24px;
            padding-right: 24px;
        }

        .subject-task-content {
            flex: 1;
        }

        .subject-task-title {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .subject-task-item.completed .subject-task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .subject-task-detail {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .subject-task-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Task Detail Panel */
        .detail-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-paper);
            padding: 24px 32px;
            box-shadow: 0 -4px 24px rgba(0,0,0,0.12);
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 200;
            border-radius: 20px 20px 0 0;
        }

        .detail-panel.active {
            transform: translateY(0);
        }

        .detail-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }

        .detail-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            flex-shrink: 0;
        }

        .detail-info {
            flex: 1;
        }

        .detail-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .detail-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .detail-tags {
            display: flex;
            gap: 8px;
        }

        .detail-actions {
            display: flex;
            gap: 12px;
        }

        .detail-btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .detail-btn.primary {
            background: var(--accent-sage);
            color: white;
        }

        .detail-btn.primary:hover {
            background: #6a9d84;
        }

        .detail-btn.secondary {
            background: var(--bg-accent);
            color: var(--text-primary);
        }

        .detail-btn.secondary:hover {
            background: var(--border-light);
        }

        /* Achievement Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-paper);
            border-radius: var(--radius-lg);
            padding: 48px;
            text-align: center;
            max-width: 400px;
            animation: modalPop 0.4s ease;
        }

        @keyframes modalPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto 24px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.3); }
            50% { box-shadow: 0 0 40px rgba(255,215,0,0.6); }
        }

        .modal-title {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .modal-desc {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .modal-btn {
            padding: 14px 40px;
            background: var(--accent-gold);
            color: var(--text-primary);
            border: none;
            border-radius: 25px;
            font-family: inherit;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .progress-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .progress-circle {
                margin: 0 auto;
            }

            .stats-row {
                justify-content: center;
            }

            .badges-section {
                align-items: center;
            }

            .subjects-grid {
                grid-template-columns: 1fr;
            }

            .header-inner {
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .task-item {
                grid-template-columns: 28px 1fr;
                gap: 12px;
            }

            .task-meta {
                grid-column: 2;
                flex-direction: row;
                align-items: center;
            }

            /* ç§»åŠ¨ç«¯ tooltip æ˜¾ç¤ºåœ¨ä¸Šæ–¹ï¼Œé¿å…è¢«ä¸‹é¢å†…å®¹é®æŒ¡ */
            .badge-tooltip {
                top: auto;
                bottom: calc(100% + 12px);
            }

            .badge-tooltip::after {
                top: 100%;
                bottom: auto;
                border-top-color: var(--text-primary);
                border-bottom-color: transparent;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="logo-section">
                <a href="index.html" class="back-link">â† è¿”å›å¤§ç¤¼åŒ…</a>
                <h1 class="site-title">å¯’å‡å­¦ä¹ è®¡åˆ’</h1>
            </div>
            <div class="view-switcher">
                <button class="view-btn active" data-view="day">æŒ‰æ—¥è®¡åˆ’</button>
                <button class="view-btn" data-view="subject">æŒ‰å­¦ç§‘</button>
            </div>
        </div>
    </header>

    <section class="progress-section">
        <div class="progress-grid">
            <div class="progress-circle">
                <svg width="140" height="140">
                    <circle class="progress-circle-bg" cx="70" cy="70" r="60"/>
                    <circle class="progress-circle-fill" cx="70" cy="70" r="60"
                            stroke-dasharray="377" stroke-dashoffset="377" id="progressRing"/>
                </svg>
                <div class="progress-text">
                    <div class="progress-percent" id="totalPercent">0%</div>
                    <div class="progress-label">æ€»è¿›åº¦</div>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-item level-item">
                    <div class="stat-value" id="levelValue">1</div>
                    <div class="stat-label" id="levelTitle">å­¦ä¹ æ–°æ‰‹</div>
                    <div class="level-tooltip">
                        <div class="level-tooltip-title">ğŸ“ˆ å‡çº§ä½“ç³»</div>
                        <div class="level-list">
                            <div class="level-row"><span class="level-num">Lv.1</span> å­¦ä¹ æ–°æ‰‹ <span class="level-req">èµ·å§‹</span></div>
                            <div class="level-row"><span class="level-num">Lv.2</span> å‹¤å¥‹å­¦å¾’ <span class="level-req">15é¡¹</span></div>
                            <div class="level-row"><span class="level-num">Lv.3</span> çŸ¥è¯†æ¢ç´¢è€… <span class="level-req">35é¡¹</span></div>
                            <div class="level-row"><span class="level-num">Lv.4</span> å­¦éœ¸å€™é€‰äºº <span class="level-req">60é¡¹</span></div>
                            <div class="level-row"><span class="level-num">Lv.5</span> èµ«è´¤ä¹‹æ˜Ÿ <span class="level-req">å…¨éƒ¨</span></div>
                        </div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streakValue">0</div>
                    <div class="stat-label">è¿ç»­æ‰“å¡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completedValue">0</div>
                    <div class="stat-label" id="totalLabel">/ 0 é¡¹</div>
                </div>
            </div>

            <div class="badges-section">
                <div class="badges-title">æˆå°±å¾½ç« </div>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>
        </div>
    </section>

    <main class="main-content">
        <div class="day-view active" id="dayView">
            <div class="day-header">
                <div class="week-nav">
                    <button class="nav-btn" onclick="changeWeek(-1)">â† ä¸Šä¸€å‘¨</button>
                    <div>
                        <div class="week-title" id="weekTitle">ç¬¬ 1 å‘¨</div>
                        <div class="week-dates" id="weekDates">1æœˆ20æ—¥ - 1æœˆ26æ—¥</div>
                    </div>
                    <button class="nav-btn" onclick="changeWeek(1)">ä¸‹ä¸€å‘¨ â†’</button>
                </div>
            </div>
            <div class="days-container" id="daysContainer"></div>
        </div>

        <div class="subject-view" id="subjectView">
            <div class="subjects-grid" id="subjectsGrid"></div>
        </div>
    </main>

    <div class="detail-panel" id="detailPanel">
        <div class="detail-content">
            <div class="detail-icon" id="detailIcon">ğŸ“š</div>
            <div class="detail-info">
                <div class="detail-title" id="detailTitle">ä»»åŠ¡æ ‡é¢˜</div>
                <div class="detail-desc" id="detailDesc">ä»»åŠ¡è¯¦ç»†æè¿°</div>
                <div class="detail-tags" id="detailTags"></div>
            </div>
            <div class="detail-actions">
                <button class="detail-btn primary" id="detailCompleteBtn" onclick="completeSelectedTask()">âœ“ å®Œæˆä»»åŠ¡</button>
                <button class="detail-btn secondary" onclick="closeDetail()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="achievementModal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon">ğŸ¯</div>
            <h2 class="modal-title" id="modalTitle">æˆå°±è§£é”ï¼</h2>
            <p class="modal-desc" id="modalDesc">æ­å–œè·å¾—æ–°æˆå°±ï¼</p>
            <button class="modal-btn" onclick="closeModal()">å¤ªæ£’äº†ï¼</button>
        </div>
    </div>

    <script>
        // ========== æ•°æ®é…ç½® ==========
        const subjects = {
            english: { name: 'è‹±è¯­', icon: 'ğŸ‡¬ğŸ‡§', color: 'english' },
            chinese: { name: 'ä¸­æ–‡', icon: 'ğŸ‡¨ğŸ‡³', color: 'chinese' },
            math: { name: 'æ•°å­¦', icon: 'ğŸ“', color: 'math' },
            physics: { name: 'ç‰©ç†', icon: 'âš¡', color: 'physics' },
            chemistry: { name: 'åŒ–å­¦', icon: 'ğŸ§ª', color: 'chemistry' },
            biology: { name: 'ç”Ÿç‰©', icon: 'ğŸ§¬', color: 'biology' },
            economics: { name: 'ç»æµ', icon: 'ğŸ’°', color: 'economics' },
            geography: { name: 'åœ°ç†', icon: 'ğŸŒ', color: 'geography' }
        };

        // è¯¦ç»†çš„æ¯æ—¥ä»»åŠ¡æ•°æ®ï¼ˆ1æœˆ31æ—¥-2æœˆ21æ—¥ï¼Œå…±22å¤©å®Œæˆï¼Œå¼€å­¦2æœˆ25æ—¥ï¼‰
        const tasks = [
            // ===== è‹±è¯­ =====
            // é˜…è¯»ã€ŠThe Secret Gardenã€‹- çº¦27ç« ï¼Œåˆ†12å¤©è¯»å®Œ
            { id: 'en_read_1', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.1-2', required: true, date: '2026-01-31', time: 40,
              detail: 'é˜…è¯»Chapter 1-2ï¼Œçº¦20é¡µã€‚è¾¹è¯»è¾¹æ‘˜å½•4-5ä¸ªç”Ÿè¯ï¼Œè®°ä¸‹è¯æ€§å’Œä¸­æ–‡æ„æ€ã€‚' },
            { id: 'en_read_2', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.3-5', required: true, date: '2026-02-01', time: 45,
              detail: 'é˜…è¯»Chapter 3-5ï¼Œç»§ç»­æ‘˜å½•ç”Ÿè¯ï¼Œæ³¨æ„Maryçš„æ€§æ ¼å˜åŒ–ã€‚' },
            { id: 'en_read_3', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.6-8', required: true, date: '2026-02-02', time: 45,
              detail: 'é˜…è¯»Chapter 6-8ï¼Œæ‘˜å½•ç”Ÿè¯ï¼Œæ³¨æ„æå†™èŠ±å›­çš„è¯æ±‡ã€‚' },
            { id: 'en_read_4', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.9-11', required: true, date: '2026-02-03', time: 45,
              detail: 'é˜…è¯»Chapter 9-11ï¼Œæ‘˜å½•ç”Ÿè¯ï¼ŒDickonå‡ºåœºã€‚' },
            { id: 'en_read_5', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.12-14', required: true, date: '2026-02-04', time: 45,
              detail: 'é˜…è¯»Chapter 12-14ï¼ŒColinå‡ºåœºï¼Œæ‘˜å½•ç”Ÿè¯ã€‚' },
            { id: 'en_read_6', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.15-17', required: true, date: '2026-02-05', time: 45,
              detail: 'é˜…è¯»Chapter 15-17ï¼Œæ‘˜å½•ç”Ÿè¯ã€‚' },
            { id: 'en_read_7', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.18-20', required: true, date: '2026-02-06', time: 45,
              detail: 'é˜…è¯»Chapter 18-20ï¼Œæ‘˜å½•ç”Ÿè¯ã€‚' },
            { id: 'en_read_8', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.21-23', required: true, date: '2026-02-07', time: 45,
              detail: 'é˜…è¯»Chapter 21-23ï¼Œæ‘˜å½•ç”Ÿè¯ã€‚' },
            { id: 'en_read_9', subject: 'english', title: 'é˜…è¯»ã€Šç§˜å¯†èŠ±å›­ã€‹Ch.24-27', required: true, date: '2026-02-08', time: 50,
              detail: 'å®Œæˆå…¨ä¹¦é˜…è¯»ï¼Œç¡®ä¿60ä¸ªç”Ÿè¯å…¨éƒ¨æ‘˜å½•å®Œæˆã€‚' },

            // è¯æ±‡æ•´ç† - 60è¯æŠ„4é+é€ å¥
            { id: 'en_vocab_1', subject: 'english', title: 'æ•´ç†ç”Ÿè¯1-20ï¼šæŠ„å†™', required: true, date: '2026-02-10', time: 45,
              detail: 'æ•´ç†å‰20ä¸ªç”Ÿè¯ï¼Œæ¯è¯æŠ„å†™4éï¼Œå†™æ¸…è¯æ€§å’Œä¸­æ–‡æ„æ€ã€‚' },
            { id: 'en_vocab_2', subject: 'english', title: 'æ•´ç†ç”Ÿè¯21-40ï¼šæŠ„å†™', required: true, date: '2026-02-11', time: 45,
              detail: 'æ•´ç†21-40å·ç”Ÿè¯ï¼Œæ¯è¯æŠ„å†™4éã€‚' },
            { id: 'en_vocab_3', subject: 'english', title: 'æ•´ç†ç”Ÿè¯41-60ï¼šæŠ„å†™', required: true, date: '2026-02-12', time: 45,
              detail: 'æ•´ç†41-60å·ç”Ÿè¯ï¼Œæ¯è¯æŠ„å†™4éã€‚' },
            { id: 'en_sentence_1', subject: 'english', title: 'ç”Ÿè¯1-20é€ å¥', required: true, date: '2026-02-14', time: 60,
              detail: 'ç”¨å‰20ä¸ªç”Ÿè¯å„é€ ä¸€ä¸ªå¥å­ï¼Œæ³¨æ„è¯­æ³•æ­£ç¡®ã€‚' },
            { id: 'en_sentence_2', subject: 'english', title: 'ç”Ÿè¯21-40é€ å¥', required: true, date: '2026-02-15', time: 60,
              detail: 'ç”¨21-40å·ç”Ÿè¯å„é€ ä¸€ä¸ªå¥å­ã€‚' },
            { id: 'en_sentence_3', subject: 'english', title: 'ç”Ÿè¯41-60é€ å¥', required: true, date: '2026-02-16', time: 60,
              detail: 'ç”¨41-60å·ç”Ÿè¯å„é€ ä¸€ä¸ªå¥å­ã€‚' },

            // è‹±æ–‡æ—¥è®° - 12ç¯‡åˆ†å¸ƒåœ¨22å¤©
            { id: 'en_diary_1', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #1', required: true, date: '2026-01-31', time: 25,
              detail: 'å†™ç¬¬1ç¯‡è‹±æ–‡æ—¥è®°ï¼Œè®°å½•å¯’å‡å¼€å§‹çš„å¿ƒæƒ…æˆ–æ´»åŠ¨ï¼Œè‡³å°‘ä¸€æ®µï¼Œæ³¨æ˜æ—¥æœŸå¤©æ°”ã€‚' },
            { id: 'en_diary_2', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #2', required: true, date: '2026-02-02', time: 25,
              detail: 'å†™ç¬¬2ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_3', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #3', required: true, date: '2026-02-04', time: 25,
              detail: 'å†™ç¬¬3ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_4', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #4', required: true, date: '2026-02-06', time: 25,
              detail: 'å†™ç¬¬4ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_5', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #5', required: true, date: '2026-02-08', time: 25,
              detail: 'å†™ç¬¬5ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_6', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #6', required: true, date: '2026-02-10', time: 25,
              detail: 'å†™ç¬¬6ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_7', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #7', required: true, date: '2026-02-12', time: 25,
              detail: 'å†™ç¬¬7ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_8', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #8', required: true, date: '2026-02-14', time: 25,
              detail: 'å†™ç¬¬8ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_9', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #9', required: true, date: '2026-02-16', time: 25,
              detail: 'å†™ç¬¬9ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_10', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #10', required: true, date: '2026-02-18', time: 25,
              detail: 'å†™ç¬¬10ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_11', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #11', required: true, date: '2026-02-19', time: 25,
              detail: 'å†™ç¬¬11ç¯‡è‹±æ–‡æ—¥è®°ã€‚' },
            { id: 'en_diary_12', subject: 'english', title: 'è‹±æ–‡æ—¥è®° #12', required: true, date: '2026-02-20', time: 25,
              detail: 'å†™ç¬¬12ç¯‡è‹±æ–‡æ—¥è®°ï¼Œæ€»ç»“æ•´ä¸ªå¯’å‡ã€‚' },

            // ä¹¦è¯„
            { id: 'en_review', subject: 'english', title: 'å†™ã€Šç§˜å¯†èŠ±å›­ã€‹ä¹¦è¯„', required: true, date: '2026-02-13', time: 60,
              detail: 'å†™ä¸€ç¯‡Book Reviewï¼šæ•…äº‹æ‘˜è¦ã€å–œæ¬¢/ä¸å–œæ¬¢çš„è§’è‰²åŠåŸå› ã€æ˜¯å¦æ¨èè¿™æœ¬ä¹¦ã€‚' },

            // æµ·æŠ¥
            { id: 'en_poster', subject: 'english', title: 'åˆ¶ä½œã€Šç§˜å¯†èŠ±å›­ã€‹æµ·æŠ¥', required: true, date: '2026-02-17', time: 90,
              detail: 'åˆ¶ä½œA4/A3å½©è‰²æµ·æŠ¥ï¼ŒåŒ…å«ä¹¦åã€ä½œè€…ã€å…³é”®è¯ï¼Œå‘æŒ¥åˆ›æ„ï¼' },

            // è§†é¢‘ï¼ˆé€‰åšï¼‰
            { id: 'en_video', subject: 'english', title: 'å½•åˆ¶è‹±æ–‡è§†é¢‘', required: false, date: '2026-02-21', time: 60,
              detail: 'ã€é€‰åšã€‘å½•åˆ¶3-5åˆ†é’Ÿè‹±æ–‡è§†é¢‘ï¼šå¯ä»¥æ˜¯é‡‡è®¿ã€æ—…è¡Œä»‹ç»ã€æ´»åŠ¨è®°å½•æˆ–å¨è‰ºå±•ç¤ºã€‚' },

            // ===== ä¸­æ–‡ =====
            // é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹- çº¦7ç« 
            { id: 'cn_read_1', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬1ç« ', required: true, date: '2026-01-31', time: 30,
              detail: 'é˜…è¯»ç¬¬1ç« ï¼Œäº†è§£å‘¼å…°æ²³å°åŸçš„æ•´ä½“é£è²Œï¼Œå¼€å§‹ç”»å°åŸç®€å›¾ã€‚' },
            { id: 'cn_read_2', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬2ç« ', required: true, date: '2026-02-02', time: 30,
              detail: 'é˜…è¯»ç¬¬2ç« ï¼Œæ³¨æ„ä½œè€…å¯¹é£ä¿—çš„æå†™ã€‚' },
            { id: 'cn_read_3', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬3ç« ', required: true, date: '2026-02-05', time: 35,
              detail: 'é˜…è¯»ç¬¬3ç« ï¼Œç¥–çˆ¶ç™»åœºï¼Œæ³¨æ„ç¥–å­™äº’åŠ¨çš„ç»†èŠ‚ã€‚' },
            { id: 'cn_read_4', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬4ç« ', required: true, date: '2026-02-08', time: 35,
              detail: 'é˜…è¯»ç¬¬4ç« ï¼Œç»§ç»­å®Œå–„å°åŸç®€å›¾ã€‚' },
            { id: 'cn_read_5', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬5ç« ', required: true, date: '2026-02-11', time: 35,
              detail: 'é˜…è¯»ç¬¬5ç« ï¼Œå°å›¢åœ†åª³å¦‡çš„æ•…äº‹ã€‚' },
            { id: 'cn_read_6', subject: 'chinese', title: 'é˜…è¯»ã€Šå‘¼å…°æ²³ä¼ ã€‹ç¬¬6ç« ', required: true, date: '2026-02-14', time: 35,
              detail: 'é˜…è¯»ç¬¬6ç« ï¼Œæœ‰äºŒä¼¯çš„æ•…äº‹ã€‚' },
            { id: 'cn_read_7', subject: 'chinese', title: 'å®Œæˆã€Šå‘¼å…°æ²³ä¼ ã€‹é˜…è¯»', required: true, date: '2026-02-17', time: 40,
              detail: 'å®Œæˆç¬¬7ç« åŠå°¾å£°ï¼Œå®Œæˆå°åŸç®€å›¾å®šç¨¿ã€‚' },

            // å†™ä¿¡
            { id: 'cn_letter', subject: 'chinese', title: 'ç»™ç¥–çˆ¶å†™ä¿¡', required: true, date: '2026-02-19', time: 60,
              detail: 'ç»™ä¹¦ä¸­çš„"ç¥–çˆ¶"å†™ä¸€å°ä¿¡ï¼Œè°ˆè°ˆä½ å¯¹ä»–çš„å°è±¡å’Œæ„Ÿå—ï¼Œ500-600å­—ã€‚' },

            // ä¹¦æ³• - æ¯éš”ä¸¤å¤©ç»ƒä¹ 
            { id: 'cn_calligraphy_1', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #1', required: true, date: '2026-02-01', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ 15åˆ†é’Ÿï¼Œä¸´æ‘¹å­—å¸–ã€‚' },
            { id: 'cn_calligraphy_2', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #2', required: true, date: '2026-02-04', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ ï¼Œæ³¨æ„ç¬”ç”»é¡ºåºã€‚' },
            { id: 'cn_calligraphy_3', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #3', required: true, date: '2026-02-07', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ ã€‚' },
            { id: 'cn_calligraphy_4', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #4', required: true, date: '2026-02-10', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ ã€‚' },
            { id: 'cn_calligraphy_5', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #5', required: true, date: '2026-02-13', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ ã€‚' },
            { id: 'cn_calligraphy_6', subject: 'chinese', title: 'ä¹¦æ³•ç»ƒä¹  #6', required: true, date: '2026-02-16', time: 15,
              detail: 'ç¡¬ç¬”ä¹¦æ³•ç»ƒä¹ ã€‚' },
            { id: 'cn_poem', subject: 'chinese', title: 'ä¹¦æ³•ä½œå“ï¼šæ‘˜æŠ„è¯—æ­Œ', required: true, date: '2026-02-20', time: 30,
              detail: 'é€‰ä¸€é¦–å–œæ¬¢çš„è¯—æ­Œï¼Œç”¨ç¡¬ç¬”ä¹¦æ³•å·¥æ•´æŠ„å†™ï¼Œä½œä¸ºæœ€ç»ˆä½œå“äº¤ç»™è€å¸ˆã€‚' },

            // ===== æ•°å­¦ =====
            { id: 'math_calculator', subject: 'math', title: 'å‡†å¤‡ç§‘å­¦è®¡ç®—å™¨', required: true, date: '2026-01-31', time: 20,
              detail: 'è´­ä¹°æˆ–å‡†å¤‡CASIO fx-999CNè®¡ç®—å™¨ï¼Œå­¦ä¼šå¼€æœºå’ŒåŸºæœ¬æ“ä½œã€‚' },
            { id: 'math_1_1', subject: 'math', title: 'é¢„ä¹ 1.1 æ•°çš„ç±»å‹', required: true, date: '2026-02-02', time: 45,
              detail: 'é¢„ä¹ 1.1 Different types of numbers (p.3-5)ï¼Œåšè¯¾åä¾‹é¢˜ï¼Œæ‘˜å½•è‹±æ–‡è¯æ±‡ã€‚' },
            { id: 'math_1_2', subject: 'math', title: 'é¢„ä¹ 1.2 å€æ•°ä¸å› æ•°', required: true, date: '2026-02-04', time: 45,
              detail: 'é¢„ä¹ 1.2 Multiples and factors (p.6-8)ï¼Œç†è§£LCMå’ŒHCFã€‚' },
            { id: 'math_1_3', subject: 'math', title: 'é¢„ä¹ 1.3 è´¨æ•°', required: true, date: '2026-02-06', time: 45,
              detail: 'é¢„ä¹ 1.3 Prime numbers (p.9-13)ï¼Œç†è§£è´¨å› æ•°åˆ†è§£ã€‚' },
            { id: 'math_1_4', subject: 'math', title: 'é¢„ä¹ 1.4 æœ‰å‘æ•°', required: true, date: '2026-02-09', time: 50,
              detail: 'é¢„ä¹ 1.4 Working with directed numbers (p.14-16)ï¼Œæ­£è´Ÿæ•°è¿ç®—ã€‚' },
            { id: 'math_1_5', subject: 'math', title: 'é¢„ä¹ 1.5 å¹‚ä¸æ ¹', required: true, date: '2026-02-12', time: 55,
              detail: 'é¢„ä¹ 1.5 Powers, roots and laws of indices (p.17-25)ï¼Œé‡ç‚¹ï¼æŒ‡æ•°æ³•åˆ™ã€‚' },
            { id: 'math_1_6', subject: 'math', title: 'é¢„ä¹ 1.6 è¿ç®—é¡ºåº', required: true, date: '2026-02-15', time: 40,
              detail: 'é¢„ä¹ 1.6 Order of operations (p.26-30)ï¼ŒBODMASæ³•åˆ™ã€‚' },
            { id: 'math_1_7', subject: 'math', title: 'é¢„ä¹ 1.7 èˆå…¥ä¸ä¼°ç®—', required: true, date: '2026-02-18', time: 45,
              detail: 'é¢„ä¹ 1.7 Rounding and estimating (p.31-36)ï¼Œsignificant figuresã€‚' },
            { id: 'math_vocab', subject: 'math', title: 'æ•´ç†æ•°å­¦è‹±æ–‡è¯æ±‡', required: true, date: '2026-02-21', time: 40,
              detail: 'æ•´ç†Unit 1æ‰€æœ‰æ•°å­¦ä¸“æœ‰è¯æ±‡ï¼Œè‹±æ–‡+ä¸­æ–‡ï¼Œæ–¹ä¾¿å¼€å­¦åæŸ¥é˜…ã€‚' },
            { id: 'math_extra', subject: 'math', title: 'é˜…è¯»æ•°å­¦è¯¾å¤–ä¹¦', required: false, date: '2026-02-21', time: 60,
              detail: 'ã€é€‰åšã€‘é˜…è¯»ã€Šçƒ§æ‰æ•°å­¦ä¹¦ã€‹ã€Šå­¦å¥½æ•°å­¦å¹¶ä¸éš¾ã€‹ç­‰æ¨èä¹¦ç±ã€‚' },

            // ===== ç‰©ç† =====
            { id: 'phy_syllabus', subject: 'physics', title: 'äº†è§£ç‰©ç†å¤§çº²', required: true, date: '2026-02-03', time: 30,
              detail: 'é˜…è¯»0653è€ƒè¯•å¤§çº²ç‰©ç†éƒ¨åˆ†(p.44-59)ï¼Œäº†è§£P1-P5äº”ä¸ªå•å…ƒçš„å†…å®¹ã€‚' },
            { id: 'phy_vocab_1', subject: 'physics', title: 'ç‰©ç†è¯æ±‡ Part 1', required: true, date: '2026-02-09', time: 35,
              detail: 'èƒŒè¯µç‰©ç†è¯æ±‡è¡¨å‰åŠéƒ¨åˆ†ï¼ŒåŒ…æ‹¬motion, force, energyç›¸å…³è¯æ±‡ã€‚' },
            { id: 'phy_vocab_2', subject: 'physics', title: 'ç‰©ç†è¯æ±‡ Part 2', required: true, date: '2026-02-15', time: 35,
              detail: 'èƒŒè¯µç‰©ç†è¯æ±‡è¡¨ååŠéƒ¨åˆ†ï¼ŒåŒ…æ‹¬waves, electricityç›¸å…³è¯æ±‡ã€‚' },
            { id: 'phy_review', subject: 'physics', title: 'å¤ä¹ ç‰©ç†è¯æ±‡', required: true, date: '2026-02-21', time: 30,
              detail: 'å¤ä¹ å…¨éƒ¨ç‰©ç†è¯æ±‡ï¼Œè‡ªæµ‹æŒæ¡æƒ…å†µã€‚' },

            // ===== åŒ–å­¦ =====
            { id: 'chem_vocab_1', subject: 'chemistry', title: 'Ch1è¯æ±‡èƒŒè¯µ', required: true, date: '2026-02-03', time: 30,
              detail: 'èƒŒè¯µChapter 1 States of matterè¯æ±‡å’Œå®šä¹‰ï¼Œåšåˆ°ä¼šè¯»ä¼šå†™ã€‚' },
            { id: 'chem_ch1_read', subject: 'chemistry', title: 'Ch1è¯¾æœ¬é˜…è¯»', required: true, date: '2026-02-06', time: 45,
              detail: 'é˜…è¯»åŒ–å­¦è¯¾æœ¬Chapter 1ï¼Œç†è§£å›ºæ¶²æ°”ä¸‰æ€ã€ç²’å­ç†è®ºï¼Œå£å¤´å›ç­”è¯¾åé—®é¢˜ã€‚' },
            { id: 'chem_ch1_ex', subject: 'chemistry', title: 'Ch1ç»ƒä¹ é¢˜', required: true, date: '2026-02-09', time: 40,
              detail: 'å®ŒæˆåŒ–å­¦ç»ƒä¹ å†ŒChapter 1ä¹ é¢˜ã€‚' },
            { id: 'chem_vocab_2', subject: 'chemistry', title: 'Ch2è¯æ±‡èƒŒè¯µ', required: true, date: '2026-02-12', time: 30,
              detail: 'èƒŒè¯µChapter 2 Atomic structureè¯æ±‡å’Œå®šä¹‰ã€‚' },
            { id: 'chem_ch2_read', subject: 'chemistry', title: 'Ch2è¯¾æœ¬é˜…è¯»', required: true, date: '2026-02-15', time: 50,
              detail: 'é˜…è¯»åŒ–å­¦è¯¾æœ¬Chapter 2ï¼Œç†è§£åŸå­ç»“æ„ã€è´¨å­ä¸­å­ç”µå­ã€å…ƒç´ å‘¨æœŸè¡¨ã€‚' },
            { id: 'chem_ch2_ex', subject: 'chemistry', title: 'Ch2ç»ƒä¹ é¢˜', required: true, date: '2026-02-18', time: 45,
              detail: 'å®ŒæˆåŒ–å­¦ç»ƒä¹ å†ŒChapter 2ä¹ é¢˜ã€‚' },
            { id: 'chem_syllabus', subject: 'chemistry', title: 'äº†è§£åŒ–å­¦è€ƒè¯•å¤§çº²', required: true, date: '2026-02-21', time: 25,
              detail: 'é˜…è¯»åŒ–å­¦è€ƒè¯•å¤§çº²Ch1-2ï¼Œäº†è§£è€ƒè¯•é‡éš¾ç‚¹ã€‚' },

            // ===== ç”Ÿç‰© =====
            { id: 'bio_b1', subject: 'biology', title: 'B1 ç”Ÿå‘½çš„ç‰¹å¾', required: true, date: '2026-02-02', time: 40,
              detail: 'é¢„ä¹ B1ç« èŠ‚ï¼Œç†è§£ç”Ÿå‘½çš„ä¸ƒå¤§ç‰¹å¾MRS GRENï¼Œè®°å½•key wordsã€‚' },
            { id: 'bio_b2', subject: 'biology', title: 'B2 ç»†èƒç»“æ„', required: true, date: '2026-02-05', time: 50,
              detail: 'é¢„ä¹ B2ç« èŠ‚ï¼Œå­¦ä¹ åŠ¨æ¤ç‰©ç»†èƒç»“æ„ã€ç»†èƒå™¨åŠŸèƒ½ã€‚' },
            { id: 'bio_b3', subject: 'biology', title: 'B3 ç”Ÿç‰©åˆ†å­', required: true, date: '2026-02-08', time: 45,
              detail: 'é¢„ä¹ B3ç« èŠ‚ï¼Œäº†è§£ç¢³æ°´åŒ–åˆç‰©ã€è›‹ç™½è´¨ã€è„‚è‚ªçš„åŠŸèƒ½ã€‚' },
            { id: 'bio_b4', subject: 'biology', title: 'B4 é…¶', required: true, date: '2026-02-11', time: 45,
              detail: 'é¢„ä¹ B4ç« èŠ‚ï¼Œç†è§£é…¶çš„ç‰¹æ€§å’Œå½±å“å› ç´ ã€‚' },
            { id: 'bio_b5', subject: 'biology', title: 'B5 æ¤ç‰©è¥å…»', required: true, date: '2026-02-14', time: 45,
              detail: 'é¢„ä¹ B5ç« èŠ‚ï¼Œå­¦ä¹ å…‰åˆä½œç”¨è¿‡ç¨‹ã€‚' },
            { id: 'bio_keywords', subject: 'biology', title: 'èƒŒè¯µç”Ÿç‰©key words', required: true, date: '2026-02-17', time: 35,
              detail: 'å¤ä¹ å¹¶èƒŒè¯µæ–‡ä»¶4ä¸­çš„ç”Ÿç‰©å…³é”®è¯æ±‡ã€‚' },
            { id: 'bio_exercise', subject: 'biology', title: 'B1-B5ç»ƒä¹ é¢˜', required: true, date: '2026-02-20', time: 60,
              detail: 'å®Œæˆæ–‡ä»¶3ä¸­B1-B5çš„ç»ƒä¹ é¢˜ã€‚' },
            { id: 'bio_bbc', subject: 'biology', title: 'è§‚çœ‹BBCçºªå½•ç‰‡', required: false, date: '2026-02-21', time: 50,
              detail: 'ã€é€‰åšã€‘è§‚çœ‹ã€Šä¸ƒä¸ªä¸–ç•Œä¸€ä¸ªæ˜Ÿçƒã€‹æˆ–ã€Šç»¿è‰²æ˜Ÿçƒã€‹çºªå½•ç‰‡ã€‚' },

            // ===== ç»æµ =====
            { id: 'econ_ch1', subject: 'economics', title: 'Ch1 ç»æµé—®é¢˜çš„æœ¬è´¨', required: true, date: '2026-02-04', time: 40,
              detail: 'é˜…è¯»Susan Grantæ•™æSection 1 Chapter 1ï¼Œæ‘˜å½•key termsåˆ°ç¬”è®°æœ¬ã€‚' },
            { id: 'econ_ch2', subject: 'economics', title: 'Ch2 ç”Ÿäº§è¦ç´ ', required: true, date: '2026-02-07', time: 45,
              detail: 'é˜…è¯»Chapter 2 The factors of productionï¼Œæ‘˜å½•key termsã€‚' },
            { id: 'econ_mindmap1', subject: 'economics', title: 'æ€ç»´å¯¼å›¾ï¼šç”Ÿäº§è¦ç´ ', required: true, date: '2026-02-10', time: 40,
              detail: 'ç»˜åˆ¶Chapter 2ç”Ÿäº§è¦ç´ çš„æ€ç»´å¯¼å›¾ã€‚' },
            { id: 'econ_ch3', subject: 'economics', title: 'Ch3 æœºä¼šæˆæœ¬', required: true, date: '2026-02-13', time: 40,
              detail: 'é˜…è¯»Chapter 3 Opportunity costï¼Œç†è§£æœºä¼šæˆæœ¬æ¦‚å¿µã€‚' },
            { id: 'econ_ch4', subject: 'economics', title: 'Ch4 ç”Ÿäº§å¯èƒ½æ€§æ›²çº¿', required: true, date: '2026-02-16', time: 45,
              detail: 'é˜…è¯»Chapter 4 Production possibility curveã€‚' },
            { id: 'econ_mindmap2', subject: 'economics', title: 'æ€ç»´å¯¼å›¾ï¼šPPCæ›²çº¿', required: true, date: '2026-02-19', time: 40,
              detail: 'ç»˜åˆ¶Chapter 4 PPCæ›²çº¿çš„æ€ç»´å¯¼å›¾ã€‚' },
            { id: 'econ_worksheet', subject: 'economics', title: 'å®Œæˆç»æµå­¦å·¥ä½œè¡¨', required: true, date: '2026-02-21', time: 50,
              detail: 'å®ŒæˆWorksheet 1.1ç»ƒä¹ é¢˜ï¼Œå¼€å­¦éœ€è¦ä¸Šäº¤ã€‚' },
            { id: 'econ_extra', subject: 'economics', title: 'ç»æµå­¦è¯¾å¤–é˜…è¯»/è§†é¢‘', required: false, date: '2026-02-21', time: 60,
              detail: 'ã€é€‰åšã€‘é˜…è¯»ã€Šç‰›å¥¶å¯ä¹ç»æµå­¦ã€‹æˆ–è§‚çœ‹ç»æµå­¦çºªå½•ç‰‡ã€‚' },

            // ===== åœ°ç† =====
            { id: 'geo_vocab_1', subject: 'geography', title: 'åœ°ç†è¯æ±‡ Part 1', required: true, date: '2026-02-05', time: 30,
              detail: 'èƒŒè¯µåœ°ç†è¯æ±‡è¡¨å‰åŠéƒ¨åˆ†ã€‚' },
            { id: 'geo_vocab_2', subject: 'geography', title: 'åœ°ç†è¯æ±‡ Part 2', required: true, date: '2026-02-11', time: 30,
              detail: 'èƒŒè¯µåœ°ç†è¯æ±‡è¡¨ååŠéƒ¨åˆ†ã€‚' },
            { id: 'geo_syllabus', subject: 'geography', title: 'äº†è§£åœ°ç†å¤§çº²', required: true, date: '2026-02-16', time: 35,
              detail: 'é˜…è¯»IG Geography Syllabus 2027-2029ï¼Œäº†è§£å„å•å…ƒçŸ¥è¯†ç‚¹ã€‚' },
            { id: 'geo_questionnaire', subject: 'geography', title: 'å®ŒæˆBeing Organisedé—®å·', required: true, date: '2026-02-19', time: 20,
              detail: 'å®Œæˆ"Being Organised"è°ƒæŸ¥é—®å·ï¼Œå¼€å­¦ä¸Šäº¤ã€‚' },
            { id: 'geo_case', subject: 'geography', title: 'Case Studyç»ƒä¹ ', required: false, date: '2026-02-21', time: 45,
              detail: 'ã€é€‰åšã€‘é€‰æ‹©ä¸€ä¸ªæ¡ˆä¾‹(River Flooding/Earthquakeç­‰)ï¼Œå®ŒæˆCase Studyæ¨¡æ¿ã€‚' },
        ];

        // å¾½ç« é…ç½®
        const badges = [
            { id: 'early_bird', icon: 'ğŸŒ…', name: 'æ—©èµ·é¸Ÿ', levels: [1, 10, 30], desc: ['å®Œæˆé¦–ä¸ªä»»åŠ¡', 'å®Œæˆ10ä¸ªä»»åŠ¡', 'å®Œæˆ30ä¸ªä»»åŠ¡'] },
            { id: 'all_rounder', icon: 'ğŸ“š', name: 'å…¨ç§‘æˆ˜å£«', levels: [3, 6, 8], desc: ['3ç§‘å„å®Œæˆ1é¡¹', '6ç§‘å„å®Œæˆ1é¡¹', '8ç§‘å„å®Œæˆ1é¡¹'] },
            { id: 'fire', icon: 'ğŸ”¥', name: 'åšæŒä¹‹ç«', levels: [3, 7, 14], desc: ['è¿ç»­æ‰“å¡3å¤©', 'è¿ç»­æ‰“å¡7å¤©', 'è¿ç»­æ‰“å¡14å¤©'] },
            { id: 'master', icon: 'ğŸ¯', name: 'å­¦ç§‘å¤§å¸ˆ', levels: [1, 3, 6], desc: ['1ç§‘100%å®Œæˆ', '3ç§‘100%å®Œæˆ', '6ç§‘100%å®Œæˆ'] },
            { id: 'halfway', icon: 'ğŸŒŸ', name: 'å¾ç¨‹è¿‡åŠ', levels: [25, 50, 75], desc: ['è¿›åº¦25%', 'è¿›åº¦50%', 'è¿›åº¦75%'] },
            { id: 'king', icon: 'ğŸ‘‘', name: 'å¯’å‡ç‹è€…', levels: [1, 2, 3], desc: ['å¿…åšå…¨å®Œæˆ', 'å¿…åš+50%é€‰åš', '100%å…¨å®Œæˆ'] }
        ];

        const levels = [
            { level: 1, name: 'å­¦ä¹ æ–°æ‰‹', required: 0 },
            { level: 2, name: 'å‹¤å¥‹å­¦å¾’', required: 15 },
            { level: 3, name: 'çŸ¥è¯†æ¢ç´¢è€…', required: 35 },
            { level: 4, name: 'å­¦éœ¸å€™é€‰äºº', required: 60 },
            { level: 5, name: 'èµ«è´¤ä¹‹æ˜Ÿ', required: tasks.length }
        ];

        // ========== çŠ¶æ€ç®¡ç† ==========
        let completedTasks = new Set();
        let userStats = { level: 1, streak_days: 0, last_active: null, badges: {}, total_completed: 0 };
        let currentWeekOffset = 0;
        let selectedTaskId = null;
        const startDate = new Date('2026-01-31');

        // ========== åˆå§‹åŒ– ==========
        function init() {
            loadFromStorage();
            renderDayView();
            renderSubjectView();
            renderBadges();
            updateStats();
            setupViewToggle();
        }

        function loadFromStorage() {
            const savedProgress = localStorage.getItem('hd_homework_progress');
            if (savedProgress) {
                try { completedTasks = new Set(JSON.parse(savedProgress)); } catch(e) {}
            }
            const savedStats = localStorage.getItem('hd_homework_stats');
            if (savedStats) {
                try { userStats = JSON.parse(savedStats); } catch(e) {}
            }
        }

        function saveToStorage() {
            localStorage.setItem('hd_homework_progress', JSON.stringify([...completedTasks]));
            localStorage.setItem('hd_homework_stats', JSON.stringify(userStats));
        }

        // ========== æ—¥è§†å›¾ ==========
        function changeWeek(delta) {
            currentWeekOffset += delta;
            if (currentWeekOffset < 0) currentWeekOffset = 0;
            if (currentWeekOffset > 3) currentWeekOffset = 3;
            renderDayView();
        }

        function renderDayView() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';

            const weekStart = new Date(startDate);
            weekStart.setDate(weekStart.getDate() + currentWeekOffset * 7);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);

            document.getElementById('weekTitle').textContent = `ç¬¬ ${currentWeekOffset + 1} å‘¨`;
            document.getElementById('weekDates').textContent =
                `${weekStart.getMonth() + 1}æœˆ${weekStart.getDate()}æ—¥ - ${weekEnd.getMonth() + 1}æœˆ${weekEnd.getDate()}æ—¥`;

            const today = new Date().toISOString().split('T')[0];
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];

            for (let i = 0; i < 7; i++) {
                const date = new Date(weekStart);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const isToday = dateStr === today;

                const dayTasks = tasks.filter(t => t.date === dateStr);
                const completedCount = dayTasks.filter(t => completedTasks.has(t.id)).length;
                const totalTime = dayTasks.reduce((sum, t) => sum + t.time, 0);

                if (dayTasks.length === 0) continue;

                const card = document.createElement('div');
                card.className = `day-card ${isToday ? 'today' : ''}`;
                card.innerHTML = `
                    <div class="day-card-header">
                        <div class="day-info">
                            <span class="day-date">${date.getDate()}æ—¥</span>
                            <span class="day-weekday">${weekdays[date.getDay()]} Â· ${date.getMonth() + 1}æœˆ</span>
                        </div>
                        <div class="day-summary">
                            <span>ğŸ“‹ ${completedCount}/${dayTasks.length} å®Œæˆ</span>
                            <span>â±ï¸ çº¦${totalTime}åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    <div class="day-tasks-list">
                        ${dayTasks.map(task => renderTaskItem(task)).join('')}
                    </div>
                `;
                container.appendChild(card);
            }
        }

        function renderTaskItem(task) {
            const isCompleted = completedTasks.has(task.id);
            const subject = subjects[task.subject];
            return `
                <div class="task-item ${isCompleted ? 'completed' : ''}" onclick="showDetail('${task.id}')">
                    <div class="task-checkbox ${isCompleted ? 'checked' : ''}" onclick="event.stopPropagation(); toggleTask('${task.id}')"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-detail">${task.detail}</div>
                    </div>
                    <div class="task-meta">
                        <div class="task-time">â±ï¸ ${task.time}åˆ†é’Ÿ</div>
                        <div class="task-tags">
                            <span class="task-tag ${task.required ? 'required' : 'optional'}">${task.required ? 'å¿…åš' : 'é€‰åš'}</span>
                            <span class="task-tag subject ${subject.color}">${subject.name}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== å­¦ç§‘è§†å›¾ ==========
        function renderSubjectView() {
            const container = document.getElementById('subjectsGrid');
            container.innerHTML = '';

            Object.entries(subjects).forEach(([key, subject]) => {
                const subjectTasks = tasks.filter(t => t.subject === key);
                const completed = subjectTasks.filter(t => completedTasks.has(t.id)).length;
                const percent = Math.round((completed / subjectTasks.length) * 100);

                const card = document.createElement('div');
                card.className = 'subject-card';
                card.innerHTML = `
                    <div class="subject-header">
                        <div class="subject-info">
                            <div class="subject-icon ${subject.color}">${subject.icon}</div>
                            <div class="subject-name">${subject.name}</div>
                        </div>
                        <div class="subject-progress">
                            <div class="subject-progress-bar">
                                <div class="subject-progress-fill" style="width: ${percent}%"></div>
                            </div>
                            <div class="subject-progress-text">${completed}/${subjectTasks.length}</div>
                        </div>
                    </div>
                    <div class="subject-tasks">
                        ${subjectTasks.map(task => `
                            <div class="subject-task-item ${completedTasks.has(task.id) ? 'completed' : ''}" onclick="showDetail('${task.id}')">
                                <div class="task-checkbox ${completedTasks.has(task.id) ? 'checked' : ''}" onclick="event.stopPropagation(); toggleTask('${task.id}')"></div>
                                <div class="subject-task-content">
                                    <div class="subject-task-title">${task.title}</div>
                                    <div class="subject-task-detail">${task.detail}</div>
                                </div>
                                <div class="subject-task-meta">
                                    <span class="task-tag ${task.required ? 'required' : 'optional'}">${task.required ? 'å¿…åš' : 'é€‰åš'}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ========== ä»»åŠ¡æ“ä½œ ==========
        function toggleTask(taskId) {
            const isCompleted = completedTasks.has(taskId);
            if (isCompleted) {
                completedTasks.delete(taskId);
            } else {
                completedTasks.add(taskId);
                checkAchievements();
            }
            saveToStorage();
            updateStats();
            renderDayView();
            renderSubjectView();
        }

        function showDetail(taskId) {
            selectedTaskId = taskId;
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const subject = subjects[task.subject];
            const isCompleted = completedTasks.has(taskId);

            document.getElementById('detailIcon').textContent = subject.icon;
            document.getElementById('detailIcon').className = `detail-icon subject-icon ${subject.color}`;
            document.getElementById('detailTitle').textContent = task.title;
            document.getElementById('detailDesc').textContent = task.detail;
            document.getElementById('detailTags').innerHTML = `
                <span class="task-tag ${task.required ? 'required' : 'optional'}">${task.required ? 'å¿…åš' : 'é€‰åš'}</span>
                <span class="task-tag subject ${subject.color}">${subject.name}</span>
                <span class="task-time">â±ï¸ ${task.time}åˆ†é’Ÿ</span>
            `;

            const btn = document.getElementById('detailCompleteBtn');
            btn.textContent = isCompleted ? 'âœ— å–æ¶ˆå®Œæˆ' : 'âœ“ å®Œæˆä»»åŠ¡';
            btn.className = `detail-btn ${isCompleted ? 'secondary' : 'primary'}`;

            document.getElementById('detailPanel').classList.add('active');
        }

        function closeDetail() {
            document.getElementById('detailPanel').classList.remove('active');
            selectedTaskId = null;
        }

        function completeSelectedTask() {
            if (selectedTaskId) {
                toggleTask(selectedTaskId);
                closeDetail();
            }
        }

        // ========== ç»Ÿè®¡æ›´æ–° ==========
        function updateStats() {
            const totalCompleted = completedTasks.size;
            const percent = Math.round((totalCompleted / tasks.length) * 100);

            // è¿›åº¦ç¯
            const ring = document.getElementById('progressRing');
            const offset = 377 - (377 * percent / 100);
            ring.style.strokeDashoffset = offset;
            document.getElementById('totalPercent').textContent = percent + '%';

            // ç­‰çº§
            let currentLevel = levels[0];
            for (const l of levels) {
                if (totalCompleted >= l.required) currentLevel = l;
            }
            document.getElementById('levelValue').textContent = currentLevel.level;
            document.getElementById('levelTitle').textContent = currentLevel.name;

            // è¿ç»­æ‰“å¡
            document.getElementById('streakValue').textContent = userStats.streak_days;

            // å®Œæˆæ•°
            document.getElementById('completedValue').textContent = totalCompleted;
            document.getElementById('totalLabel').textContent = `/ ${tasks.length} é¡¹`;
        }

        // ========== å¾½ç«  ==========
        function renderBadges() {
            const container = document.getElementById('badgesGrid');
            const levelNames = ['æœªè§£é”', 'é“œç‰Œ', 'é“¶ç‰Œ', 'é‡‘ç‰Œ'];

            container.innerHTML = badges.map(badge => {
                const level = userStats.badges[badge.id] || 0;
                const levelClass = level === 0 ? 'locked' : ['', 'bronze', 'silver', 'gold'][level];

                // è·å–å½“å‰è¿›åº¦ä¿¡æ¯
                let progressText = '';
                if (level < 3) {
                    const nextLevel = level + 1;
                    progressText = `ä¸‹ä¸€çº§: ${badge.desc[nextLevel - 1]}`;
                } else {
                    progressText = 'ğŸ‰ å·²æ»¡çº§ï¼';
                }

                // è·å–æ‰€æœ‰ç­‰çº§çš„è¯´æ˜
                const allLevels = badge.levels.map((req, i) => {
                    const achieved = level > i;
                    const current = level === i + 1;
                    return `<div style="color: ${achieved ? '#81b29a' : current ? '#f2cc8f' : 'rgba(255,255,255,0.5)'}">
                        ${achieved ? 'âœ“' : current ? 'â˜…' : 'â—‹'} ${['é“œ', 'é“¶', 'é‡‘'][i]}: ${badge.desc[i]}
                    </div>`;
                }).join('');

                return `
                    <div class="badge-item ${levelClass}">
                        ${badge.icon}
                        <div class="badge-tooltip">
                            <div class="badge-tooltip-name">${badge.name}</div>
                            <div class="badge-tooltip-level">${levelNames[level]}</div>
                            <div class="badge-tooltip-desc" style="white-space: normal; text-align: left;">
                                ${allLevels}
                            </div>
                            ${level < 3 ? `<div class="badge-tooltip-progress">${progressText}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function checkAchievements() {
            const totalCompleted = completedTasks.size;
            const totalRequired = tasks.filter(t => t.required).length;
            const completedRequired = tasks.filter(t => t.required && completedTasks.has(t.id)).length;
            const completedOptional = tasks.filter(t => !t.required && completedTasks.has(t.id)).length;
            const percent = Math.round((totalCompleted / tasks.length) * 100);

            const subjectCompletions = {};
            Object.keys(subjects).forEach(s => {
                const subjectTasks = tasks.filter(t => t.subject === s);
                const completed = subjectTasks.filter(t => completedTasks.has(t.id)).length;
                subjectCompletions[s] = { completed, total: subjectTasks.length, percent: Math.round((completed / subjectTasks.length) * 100) };
            });

            const subjectsWithCompletions = Object.values(subjectCompletions).filter(s => s.completed > 0).length;
            const subjectsWith100 = Object.values(subjectCompletions).filter(s => s.percent === 100).length;

            const oldBadges = { ...userStats.badges };

            // æ£€æŸ¥å„å¾½ç« 
            if (totalCompleted >= 30) userStats.badges.early_bird = 3;
            else if (totalCompleted >= 10) userStats.badges.early_bird = 2;
            else if (totalCompleted >= 1) userStats.badges.early_bird = 1;

            if (subjectsWithCompletions >= 8) userStats.badges.all_rounder = 3;
            else if (subjectsWithCompletions >= 6) userStats.badges.all_rounder = 2;
            else if (subjectsWithCompletions >= 3) userStats.badges.all_rounder = 1;

            if (userStats.streak_days >= 14) userStats.badges.fire = 3;
            else if (userStats.streak_days >= 7) userStats.badges.fire = 2;
            else if (userStats.streak_days >= 3) userStats.badges.fire = 1;

            if (subjectsWith100 >= 6) userStats.badges.master = 3;
            else if (subjectsWith100 >= 3) userStats.badges.master = 2;
            else if (subjectsWith100 >= 1) userStats.badges.master = 1;

            if (percent >= 75) userStats.badges.halfway = 3;
            else if (percent >= 50) userStats.badges.halfway = 2;
            else if (percent >= 25) userStats.badges.halfway = 1;

            if (totalCompleted === tasks.length) userStats.badges.king = 3;
            else if (completedRequired === totalRequired && completedOptional >= tasks.filter(t => !t.required).length / 2) userStats.badges.king = 2;
            else if (completedRequired === totalRequired) userStats.badges.king = 1;

            // æ˜¾ç¤ºæ–°å¾½ç« 
            for (const [badgeId, level] of Object.entries(userStats.badges)) {
                if (!oldBadges[badgeId] || oldBadges[badgeId] < level) {
                    const badge = badges.find(b => b.id === badgeId);
                    showAchievement(badge, level);
                    break;
                }
            }

            saveToStorage();
            renderBadges();
        }

        function showAchievement(badge, level) {
            const levelNames = ['', 'é“œç‰Œ', 'é“¶ç‰Œ', 'é‡‘ç‰Œ'];
            const levelClasses = ['', 'bronze', 'silver', 'gold'];
            document.getElementById('modalIcon').textContent = badge.icon;
            document.getElementById('modalIcon').className = `modal-icon badge-item ${levelClasses[level]}`;
            document.getElementById('modalTitle').textContent = `${badge.name} Â· ${levelNames[level]}`;
            document.getElementById('modalDesc').textContent = badge.desc[level - 1];
            document.getElementById('achievementModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('achievementModal').classList.remove('active');
        }

        // ========== è§†å›¾åˆ‡æ¢ ==========
        function setupViewToggle() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const view = btn.dataset.view;
                    document.getElementById('dayView').classList.toggle('active', view === 'day');
                    document.getElementById('subjectView').classList.toggle('active', view === 'subject');
                });
            });
        }

        // å¯åŠ¨
        init();
    </script>
</body>
</html>
